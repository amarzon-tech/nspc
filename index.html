<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kidney Care Plan</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f7fbfd; margin: 20px; }
    h1 { text-align: center; color: #2c3e50; }
    input, select, textarea, button {
      width: 100%; padding: 8px; margin: 6px 0; font-size: 14px;
    }
    label { font-weight: bold; display: block; margin-top: 10px; }
    .chart-container { width: 100%; margin-top: 20px; background: #fff; border-radius: 8px; }
    canvas { background: #fff; border-radius: 8px; height: 200px !important; }
    .inline { display: flex; flex-wrap: wrap; gap: 10px; }
    .inline label { flex: 1 0 200px; }
    #heatmapTable { border-collapse: collapse; margin-top: 20px; width: 100%; }
    #heatmapTable td, #heatmapTable th {
      padding: 6px; text-align: center; border: 1px solid #aaa; font-weight: bold;
    }
    .green { background-color: #b6ffb6; }
    .yellow { background-color: #fff79a; }
    .orange { background-color: #ffc78a; }
    .red { background-color: #ff7b7b; }
    #exportBtn { background: #3498db; color: white; font-size: 16px; margin-top: 20px; }
  </style>
</head>
<body>
<h1>Kidney Care Plan</h1>

<!-- KDIGO Heatmap Table -->
<table id="heatmapTable">
  <thead>
    <tr>
      <th></th>
      <th>Normal to mildly increased</th>
      <th>Moderately increased</th>
      <th>Severely increased</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>GFR &ge; 90</th>
      <td class="green">A1</td>
      <td class="yellow">A2</td>
      <td class="orange">A3</td>
    </tr>
    <tr>
      <th>GFR 60–89</th>
      <td class="green">A1</td>
      <td class="yellow">A2</td>
      <td class="orange">A3</td>
    </tr>
    <tr>
      <th>GFR 45–59</th>
      <td class="yellow">A1</td>
      <td class="orange">A2</td>
      <td class="red">A3</td>
    </tr>
    <tr>
      <th>GFR 30–44</th>
      <td class="orange">A1</td>
      <td class="red">A2</td>
      <td class="red">A3</td>
    </tr>
    <tr>
      <th>GFR 15–29</th>
      <td class="red">A1</td>
      <td class="red">A2</td>
      <td class="red">A3</td>
    </tr>
    <tr>
      <th>GFR &lt; 15</th>
      <td class="red">A1</td>
      <td class="red">A2</td>
      <td class="red">A3</td>
    </tr>
  </tbody>
</table>

<!-- Charts -->
<div class="chart-container">
  <canvas id="gfrChart"></canvas>
</div>
<div class="chart-container">
  <canvas id="creatinineChart"></canvas>
</div>
<div class="chart-container">
  <canvas id="albuminuriaChart"></canvas>
</div>

<button id="exportBtn">Export to PDF</button>
<script>
  // NSPC logo base64 image (small example; replace with your full image base64)
  const nspcLogoBase64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABCAAAAJCAYAAABT9SQEAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNklEQVR4nKWSS0/CQBCGv4zWKa0Fsl0XcShqK/ALq4F7cgS4Mh1A28QUOyGMtbohYmUQdXDQDFCBMSwl6Ri8E24P/fgIZ0AvT8T+Gk0/GP7wsx+SJI8Ik9Ak8WvQFR78k2kWQ0lHC1JHqJh0Xi6GEdWh8R0QpRhEVB4OBRUR5P4EEpcLcrLEBA9vka4nwHCv8CSkO4AiioLSa8nwiQaLkA8Lm2B0K93UQJhnCWLFv3bp1YW1tTbfu3IlZWVmAZPpVJK6ucrdu3dPpPJ5dDfDfu3KlF9fH1DYhDixYtM2nSJElFArVaxdu2bEzo0aN6PCIfqOl0OplGMP9oBqvV6tW7dqEckSbT1zq8vLuTHv27KH+rtTgAAAABJRU5ErkJggg==';

  const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'];
  const gfrData = [90, 85, 80, 75, 70, 65, 60];
  const creatinineData = [1.1, 1.2, 1.3, 1.4, 1.3, 1.2, 1.1];
  const albuminuriaData = [30, 35, 40, 45, 50, 55, 60];

  // GFR Chart (colored)
  const gfrCtx = document.getElementById('gfrChart').getContext('2d');
  const gfrChart = new Chart(gfrCtx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'GFR',
        data: gfrData,
        borderColor: 'rgb(75, 192, 192)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        fill: true,
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: true } }
    }
  });

  // Creatinine Chart - grayscale
  const creatinineCtx = document.getElementById('creatinineChart').getContext('2d');
  const creatinineChart = new Chart(creatinineCtx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'Creatinine',
        data: creatinineData,
        borderColor: 'gray',
        backgroundColor: 'transparent',
        fill: false,
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: true } }
    }
  });

  // Albuminuria Chart - grayscale
  const albuminuriaCtx = document.getElementById('albuminuriaChart').getContext('2d');
  const albuminuriaChart = new Chart(albuminuriaCtx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'Albuminuria',
        data: albuminuriaData,
        borderColor: 'gray',
        backgroundColor: 'transparent',
        fill: false,
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: true } }
    }
  });

  // PDF Export button handler
  document.getElementById('exportBtn').addEventListener('click', async () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    // Add NSPC logo
    pdf.addImage(nspcLogoBase64, 'PNG', 10, 10, 50, 15);

    // Add Title
    pdf.setFontSize(18);
    pdf.text('Kidney Care Plan', 70, 20);

    // Capture heatmap table as image using html2canvas
    const heatmapCanvas = await html2canvas(document.getElementById('heatmapTable'));
    const heatmapImgData = heatmapCanvas.toDataURL('image/png');
    pdf.addImage(heatmapImgData, 'PNG', 10, 30, 180, 80);

    // Position to add charts
    let yOffset = 120;

    // Add GFR chart image (color)
    const gfrImg = document.getElementById('gfrChart').toDataURL('image/png');
    pdf.addImage(gfrImg, 'PNG', 10, yOffset, 90, 60);

    // Add Creatinine chart image (grayscale)
    const creatinineImg = document.getElementById('creatinineChart').toDataURL('image/png');
    pdf.addImage(creatinineImg, 'PNG', 105, yOffset, 90, 60);

    yOffset += 70;

    // Add Albuminuria chart image (grayscale)
    const albuminuriaImg = document.getElementById('albuminuriaChart').toDataURL('image/png');
    pdf.addImage(albuminuriaImg, 'PNG', 10, yOffset, 90, 60);

    // Save the PDF
    pdf.save('kidney-care-plan.pdf');
  });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</body>
</html>
